<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Shop - Recommendation System</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script>
        const API_URL = 'http://localhost:8000';
        let currentUser = null;
        let currentView = 'login';
        let products = [];
        let recommendations = [];
        let categories = [];
        let searchTerm = '';
        let selectedCategory = '';
        let currentUserHistory = [];
        let userProfile = null;

        // Initialize
        function init() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                currentView = 'products';
                loadProducts();
                loadCategories();
                loadRecommendations();
                loadUserProfile();
            }
            render();
        }

        // API Calls
        async function loadUserHistory() {
    if (!currentUser) return;
    try {
        const response = await fetch(`${API_URL}/api/users/${currentUser.user_id}/history`);
        const data = await response.json();
        currentUserHistory = data.history;
        if (currentView === 'history') render();
    } catch (err) {
        console.error('Error loading history:', err);
    }
}

async function updateUserProfile(username, preferences) {
    if (!currentUser) return;
    
    try {
        const response = await fetch(`${API_URL}/api/users/${currentUser.user_id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, preferences })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            userProfile = data.user;
            currentUser.username = data.user.username;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            alert('‚úÖ Profile updated successfully!');
            render();
        } else {
            alert('‚ùå Error: ' + data.detail);
        }
    } catch (err) {
        alert('‚ùå Error updating profile: ' + err.message);
    }
}

async function loadUserStats() {
    if (!currentUser) return;
    
    try {
        const response = await fetch(`${API_URL}/api/users/${currentUser.user_id}/history`);
        const data = await response.json();
        
        const total = data.history.length;
        const likes = data.history.filter(h => h.interaction_type === 'like').length;
        const views = data.history.filter(h => h.interaction_type === 'view').length;
        
        document.getElementById('stats-interactions').textContent = total;
        document.getElementById('stats-likes').textContent = likes;
        document.getElementById('stats-views').textContent = views;
    } catch (err) {
        console.error('Error loading stats:', err);
    }
}

async function loadUserProfile() {
    if (!currentUser) return;
    try {
        const response = await fetch(`${API_URL}/api/users/${currentUser.user_id}`);
        const data = await response.json();
        userProfile = data;
        if (currentView === 'profile') render();
    } catch (err) {
        console.error('Error loading profile:', err);
    }
}


        async function login(email, password) {
    try {
        const response = await fetch(`${API_URL}/api/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
        });
        const data = await response.json();
        if (response.ok) {
            currentUser = data;
            localStorage.setItem('currentUser', JSON.stringify(data));
            currentView = 'products';
            loadProducts();
            loadCategories();
            loadRecommendations();
            loadUserProfile(); // ‚Üê –î–û–ë–ê–í–¨ –≠–¢–û
            render();
        } else {
            alert(data.detail || 'Login failed');
        }
    } catch (err) {
        alert('Login failed: ' + err.message);
    }
}

        async function register(username, email, password) {
            try {
                const response = await fetch(`${API_URL}/api/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, email, password, preferences: [] })
                });
                const data = await response.json();
                if (response.ok) {
                    alert('Registration successful! Please login.');
                    currentView = 'login';
                    render();
                } else {
                    alert(data.detail || 'Registration failed');
                }
            } catch (err) {
                alert('Registration failed: ' + err.message);
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            currentView = 'login';
            products = [];
            recommendations = [];
            render();
        }

        async function loadProducts() {
            try {
                let url = `${API_URL}/api/products`;
                const params = new URLSearchParams();
                if (searchTerm) params.append('search', searchTerm);
                if (selectedCategory) params.append('category', selectedCategory);
                if (params.toString()) url += `?${params.toString()}`;

                const response = await fetch(url);
                const data = await response.json();
                products = data.products;
                render();
            } catch (err) {
                console.error('Error loading products:', err);
            }
        }

        async function loadRecommendations() {
            if (!currentUser) return;
            try {
                const response = await fetch(`${API_URL}/api/recommendations/${currentUser.user_id}?n=8`);
                const data = await response.json();
                recommendations = data.recommendations;
                render();
            } catch (err) {
                console.error('Error loading recommendations:', err);
            }
        }

        async function loadCategories() {
            try {
                const response = await fetch(`${API_URL}/api/categories`);
                const data = await response.json();
                categories = data.categories;
                render();
            } catch (err) {
                console.error('Error loading categories:', err);
            }
        }

        async function trackInteraction(productId, type) {
            if (!currentUser) return;
            try {
                await fetch(`${API_URL}/api/interactions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: currentUser.user_id,
                        product_id: productId,
                        interaction_type: type
                    })
                });
                if (type === 'like') {
                    loadRecommendations();
                }
            } catch (err) {
                console.error('Error tracking interaction:', err);
            }
        }

        // Render Functions
        function render() {
    const app = document.getElementById('app');
    
    if (currentView === 'login') {
        app.innerHTML = renderLogin();
    } else if (currentView === 'register') {
        app.innerHTML = renderRegister();
    } else {
        app.innerHTML = renderMain();
    }
    
    attachEventListeners();
}

        function renderLogin() {
            return `
                <div class="min-h-screen bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                        <h1 class="text-3xl font-bold text-center mb-6 text-gray-800">E-Shop</h1>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                <input id="login-email" type="email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="alice@example.com" value="alice@example.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                <input id="login-password" type="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="password123" value="password123">
                            </div>
                            <button id="login-btn" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
                                Login
                            </button>
                        </div>
                        <p class="text-center mt-4 text-sm text-gray-600">
                            Don't have an account? 
                            <button id="goto-register" class="text-blue-600 font-semibold hover:underline">Register</button>
                        </p>
                        <div class="mt-6 p-3 bg-gray-100 rounded-lg text-xs text-gray-600">
                            <p class="font-semibold mb-1">Test credentials:</p>
                            <p>alice@example.com / password123</p>
                            <p>bob@example.com / password123</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderRegister() {
            return `
                <div class="min-h-screen bg-gradient-to-br from-purple-500 to-pink-600 flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                        <h1 class="text-3xl font-bold text-center mb-6 text-gray-800">Create Account</h1>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                                <input id="register-username" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                <input id="register-email" type="email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                <input id="register-password" type="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            </div>
                            <button id="register-btn" class="w-full bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700 transition">
                                Register
                            </button>
                        </div>
                        <p class="text-center mt-4 text-sm text-gray-600">
                            Already have an account? 
                            <button id="goto-login" class="text-purple-600 font-semibold hover:underline">Login</button>
                        </p>
                    </div>
                </div>
            `;
        }

        function renderMain() {
    return `
        <header class="bg-white shadow-md sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
                <h1 class="text-2xl font-bold text-blue-600">E-Shop</h1>
                <div class="flex items-center gap-4">
                    <button id="view-products" class="px-4 py-2 ${currentView === 'products' ? 'bg-blue-600 text-white' : 'bg-blue-100 text-blue-700'} rounded-lg font-medium hover:bg-blue-200 transition">
                        üì¶ Products
                    </button>
                    <button id="view-recommendations" class="px-4 py-2 ${currentView === 'recommendations' ? 'bg-purple-600 text-white' : 'bg-purple-100 text-purple-700'} rounded-lg font-medium hover:bg-purple-200 transition">
                        ‚≠ê Recommendations
                    </button>
                    <button id="view-history" class="px-4 py-2 ${currentView === 'history' ? 'bg-green-600 text-white' : 'bg-green-100 text-green-700'} rounded-lg font-medium hover:bg-green-200 transition">
                        üìú History
                    </button>
                    <button id="view-profile" class="px-4 py-2 ${currentView === 'profile' ? 'bg-indigo-600 text-white' : 'bg-indigo-100 text-indigo-700'} rounded-lg font-medium hover:bg-indigo-200 transition">
                        üë§ Profile
                    </button>
                    <button id="logout-btn" class="text-red-500 hover:text-red-700 font-medium">üö™ Logout</button>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-4 py-6">
            ${currentView === 'products' ? renderProductsView() : 
              currentView === 'recommendations' ? renderRecommendationsView() :
              currentView === 'history' ? renderHistoryView() :
              currentView === 'profile' ? renderProfileView() : ''}
        </div>
    `;
}

        function renderHistoryView() {
    const history = currentUserHistory || [];
    
    return `
        <h2 class="text-2xl font-bold mb-6 text-gray-800">Your Activity History</h2>
        ${history.length === 0 ? 
            '<p class="text-gray-500">No activity yet. Start browsing products!</p>' :
            `<div class="space-y-4">
                ${history.map(item => `
                    <div class="bg-white rounded-lg shadow p-4 flex gap-4">
                        <img src="${item.product.image_url}" alt="${item.product.name}" class="w-24 h-24 object-cover rounded">
                        <div class="flex-1">
                            <h3 class="font-semibold text-lg">${item.product.name}</h3>
                            <p class="text-sm text-gray-600 mb-2">${item.product.description}</p>
                            <div class="flex items-center gap-4 text-sm">
                                <span class="px-2 py-1 rounded ${
                                    item.interaction_type === 'like' ? 'bg-red-100 text-red-700' :
                                    item.interaction_type === 'rating' ? 'bg-yellow-100 text-yellow-700' :
                                    'bg-blue-100 text-blue-700'
                                }">
                                    ${item.interaction_type === 'like' ? '‚ù§Ô∏è Liked' : 
                                      item.interaction_type === 'rating' ? `‚≠ê Rated ${item.rating}/5` :
                                      'üëÅÔ∏è Viewed'}
                                </span>
                                <span class="text-gray-500">${new Date(item.timestamp).toLocaleString()}</span>
                                <span class="font-bold text-blue-600">$${item.product.price}</span>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>`
        }
    `;
}

        function renderProductsView() {
            return `
                <div class="mb-6 bg-white p-4 rounded-lg shadow">
                    <div class="flex gap-4">
                        <input id="search-input" type="text" value="${searchTerm}" placeholder="Search products..." class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <select id="category-select" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">All Categories</option>
                            ${categories.map(cat => `<option value="${cat}" ${cat === selectedCategory ? 'selected' : ''}>${cat}</option>`).join('')}
                        </select>
                        <button id="search-btn" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                            üîç Search
                        </button>
                    </div>
                </div>

                <h2 class="text-2xl font-bold mb-6 text-gray-800">${selectedCategory || 'All Products'}</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    ${products.map(product => renderProductCard(product)).join('')}
                </div>
            `;
        }

        function renderRecommendationsView() {
            return `
                <h2 class="text-2xl font-bold mb-6 text-gray-800">Recommended for You</h2>
                ${recommendations.length === 0 ? 
                    '<p class="text-gray-500">No recommendations yet. Interact with products to get personalized suggestions!</p>' :
                    `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        ${recommendations.map(product => renderProductCard(product, true)).join('')}
                    </div>`
                }
            `;
        }

        function renderProductCard(product, showScore = false) {
            return `
                <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition transform hover:-translate-y-1">
                    <div class="h-48 bg-gray-200 flex items-center justify-center" onclick="trackInteraction('${product._id}', 'view')">
                        <img src="${product.image_url}" alt="${product.name}" class="w-full h-full object-cover">
                    </div>
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold text-gray-800 text-lg line-clamp-2">${product.name}</h3>
                            <button onclick="trackInteraction('${product._id}', 'like')" class="text-gray-400 hover:text-red-500 transition">
                                ‚ù§Ô∏è
                            </button>
                        </div>
                        <p class="text-sm text-gray-600 mb-3 line-clamp-2">${product.description}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded">${product.category}</span>
                            <span class="text-xl font-bold text-blue-600">$${product.price}</span>
                        </div>
                        ${showScore && product.recommendation_score ? 
                            `<div class="mt-2 text-sm text-purple-600 italic">
                                ‚≠ê Match: ${(product.recommendation_score * 20).toFixed(0)}%
                            </div>` : ''
                        }
                    </div>
                </div>
            `;
        }

        function renderProfileView() {
    if (!userProfile) {
        return '<div class="text-center py-8"><p class="text-gray-500">Loading profile...</p></div>';
    }
    
    const allCategories = ['Electronics', 'Books', 'Clothing', 'Sports', 'Home & Garden', 'Beauty', 'Toys'];
    
    return `
        <div class="max-w-3xl mx-auto">
            <h2 class="text-3xl font-bold mb-8 text-gray-800">My Profile</h2>
            
            <!-- Profile Card -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-6">
                <div class="flex items-center mb-6">
                    <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-3xl font-bold">
                        ${userProfile.username.charAt(0).toUpperCase()}
                    </div>
                    <div class="ml-6">
                        <h3 class="text-2xl font-bold text-gray-800">${userProfile.username}</h3>
                        <p class="text-gray-600">${userProfile.email}</p>
                        <p class="text-sm text-gray-500 mt-1">Member since ${new Date(userProfile.created_at).toLocaleDateString()}</p>
                    </div>
                </div>
                
                <!-- Edit Mode Toggle -->
                <div class="border-t pt-6 mt-6">
                    <div id="view-mode">
                        <div class="mb-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-3">Basic Information</h4>
                            <div class="space-y-2">
                                <div class="flex">
                                    <span class="text-gray-600 w-32">Username:</span>
                                    <span class="font-medium">${userProfile.username}</span>
                                </div>
                                <div class="flex">
                                    <span class="text-gray-600 w-32">Email:</span>
                                    <span class="font-medium">${userProfile.email}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-3">Favorite Categories</h4>
                            <div class="flex flex-wrap gap-2">
                                ${userProfile.preferences && userProfile.preferences.length > 0 
                                    ? userProfile.preferences.map(pref => 
                                        `<span class="px-4 py-2 bg-blue-100 text-blue-700 rounded-full font-medium">${pref}</span>`
                                    ).join('')
                                    : '<span class="text-gray-500">No preferences set</span>'
                                }
                            </div>
                        </div>
                        
                        <button id="edit-profile-btn" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition">
                            ‚úèÔ∏è Edit Profile
                        </button>
                    </div>
                    
                    <div id="edit-mode" style="display: none;">
                        <div class="mb-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-3">Edit Basic Information</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                                    <input id="edit-username" type="text" value="${userProfile.username}" 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Email (cannot be changed)</label>
                                    <input type="email" value="${userProfile.email}" disabled
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-600">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-3">Select Your Favorite Categories</h4>
                            <p class="text-sm text-gray-600 mb-3">Choose categories you're interested in to get better recommendations</p>
                            <div class="flex flex-wrap gap-2" id="category-checkboxes">
                                ${allCategories.map(cat => `
                                    <label class="inline-flex items-center cursor-pointer px-4 py-2 rounded-full border-2 ${
                                        userProfile.preferences && userProfile.preferences.includes(cat) 
                                            ? 'bg-indigo-100 border-indigo-500 text-indigo-700' 
                                            : 'bg-gray-50 border-gray-300 text-gray-700'
                                    } hover:border-indigo-400 transition">
                                        <input type="checkbox" value="${cat}" 
                                            ${userProfile.preferences && userProfile.preferences.includes(cat) ? 'checked' : ''}
                                            class="hidden category-checkbox">
                                        <span class="font-medium">${cat}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="flex gap-3">
                            <button id="save-profile-btn" class="flex-1 bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition">
                                üíæ Save Changes
                            </button>
                            <button id="cancel-edit-btn" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-400 transition">
                                ‚ùå Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Statistics Card -->
            <div class="bg-gradient-to-br from-purple-500 to-indigo-600 rounded-2xl shadow-lg p-8 text-white">
                <h3 class="text-xl font-bold mb-6">Your Activity Stats</h3>
                <div class="grid grid-cols-3 gap-6">
                    <div class="text-center">
                        <div class="text-4xl font-bold mb-2" id="stats-interactions">-</div>
                        <div class="text-sm opacity-90">Total Interactions</div>
                    </div>
                    <div class="text-center">
                        <div class="text-4xl font-bold mb-2" id="stats-likes">-</div>
                        <div class="text-sm opacity-90">Products Liked</div>
                    </div>
                    <div class="text-center">
                        <div class="text-4xl font-bold mb-2" id="stats-views">-</div>
                        <div class="text-sm opacity-90">Products Viewed</div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

        function attachEventListeners() {
            // Login
            const loginBtn = document.getElementById('login-btn');
            if (loginBtn) {
                loginBtn.onclick = () => {
                    const email = document.getElementById('login-email').value;
                    const password = document.getElementById('login-password').value;
                    login(email, password);
                };
            }

            // Register
            const registerBtn = document.getElementById('register-btn');
            if (registerBtn) {
                registerBtn.onclick = () => {
                    const username = document.getElementById('register-username').value;
                    const email = document.getElementById('register-email').value;
                    const password = document.getElementById('register-password').value;
                    register(username, email, password);
                };
            }

            // Navigation
            const gotoRegister = document.getElementById('goto-register');
            if (gotoRegister) gotoRegister.onclick = () => { currentView = 'register'; render(); };

            const gotoLogin = document.getElementById('goto-login');
            if (gotoLogin) gotoLogin.onclick = () => { currentView = 'login'; render(); };

            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) logoutBtn.onclick = logout;

            const viewProducts = document.getElementById('view-products');
            if (viewProducts) viewProducts.onclick = () => { currentView = 'products'; render(); };

            const viewRecommendations = document.getElementById('view-recommendations');
            if (viewRecommendations) viewRecommendations.onclick = () => { currentView = 'recommendations'; render(); };

            // Search
            const searchBtn = document.getElementById('search-btn');
            if (searchBtn) {
                searchBtn.onclick = () => {
                    searchTerm = document.getElementById('search-input').value;
                    selectedCategory = document.getElementById('category-select').value;
                    loadProducts();
                };
            }

            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.onkeypress = (e) => {
                    if (e.key === 'Enter') {
                        searchTerm = searchInput.value;
                        loadProducts();
                    }
                };
            }

            const categorySelect = document.getElementById('category-select');
            if (categorySelect) {
                categorySelect.onchange = () => {
                    selectedCategory = categorySelect.value;
                    loadProducts();
                };
            }

// History
const viewHistory = document.getElementById('view-history');
if (viewHistory) viewHistory.onclick = () => { 
    currentView = 'history'; 
    loadUserHistory();
    render(); 
}

// Profile view
const viewProfile = document.getElementById('view-profile');
if (viewProfile) viewProfile.onclick = () => { 
    currentView = 'profile'; 
    loadUserProfile();
    render();
    setTimeout(loadUserStats, 100);
};

// Edit profile mode
const editProfileBtn = document.getElementById('edit-profile-btn');
if (editProfileBtn) {
    editProfileBtn.onclick = () => {
        document.getElementById('view-mode').style.display = 'none';
        document.getElementById('edit-mode').style.display = 'block';
        
        // Add checkbox listeners
        const checkboxes = document.querySelectorAll('.category-checkbox');
        checkboxes.forEach(cb => {
            cb.onchange = (e) => {
                const label = e.target.parentElement;
                if (e.target.checked) {
                    label.classList.remove('bg-gray-50', 'border-gray-300', 'text-gray-700');
                    label.classList.add('bg-indigo-100', 'border-indigo-500', 'text-indigo-700');
                } else {
                    label.classList.remove('bg-indigo-100', 'border-indigo-500', 'text-indigo-700');
                    label.classList.add('bg-gray-50', 'border-gray-300', 'text-gray-700');
                }
            };
        });
    };
}

// Save profile
const saveProfileBtn = document.getElementById('save-profile-btn');
if (saveProfileBtn) {
    saveProfileBtn.onclick = () => {
        const username = document.getElementById('edit-username').value;
        const selectedPreferences = Array.from(document.querySelectorAll('.category-checkbox:checked'))
            .map(cb => cb.value);
        
        if (!username.trim()) {
            alert('Username cannot be empty');
            return;
        }
        
        updateUserProfile(username, selectedPreferences);
    };
}

// Cancel edit
const cancelEditBtn = document.getElementById('cancel-edit-btn');
if (cancelEditBtn) {
    cancelEditBtn.onclick = () => {
        document.getElementById('view-mode').style.display = 'block';
        document.getElementById('edit-mode').style.display = 'none';
    };
}



        }

        // Start the app
        init();
    </script>
</body>
</html>